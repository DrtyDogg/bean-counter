{% extends "base.html" %}

{% block styles %}
{{ super() }}
<style>
    .bg-danger {
        background-color: #d9534f;
    }

    .bg-success {
        background-color: #5cb85c;
    }

    .bg-info {
        background-color: #5bc0de;
    }

    .bg-primary {
        background-color: #428bca;
    }

    .bg-warning {
        background-color: #f0ad43;
    }

    .text-white {
        color: white;
    }

    .well.h3 {
        padding-top: 0px;
    }
</style>
{% endblock%}


{% block app_content %}
<div class="panel panel-default">
    <div class="panel-heading">
        <h2>Weekly Stats</h2>
    </div>
    <div class="panel-body">
        <!-- The dashboar for weekly -->
            <div class="col-md-4 col-sm-6 col-xs-12">
                <div class="col-xs-12 well well-lg
                     {{ 'bg-success' if ((categories | sum(attribute='budget_amount')) - ((categories | sum(attribute='weekly_total') or 0) or 0)) >= 0 }}
                     {{ 'bg-danger' if ((categories | sum(attribute='budget_amount')) - ((categories | sum(attribute='weekly_total') or 0) or 0)) < 0 }}">
                    <h3 class="text-white">Remaining</h3>
                    <h2 class="text-center text-white">
                        {{ ((categories | sum(attribute='budget_amount')) - ((categories | sum(attribute='weekly_total') or 0) or 0)) | dollars}}
                    </h2>
                </div>
            </div>
            <div class="col-md-4 col-sm-6 hidden-xs">
                <div class="col-xs-12 well well-lg bg-info">
                    <h3 class="text-white">Total</h3>
                    <h2 class="text-center text-white">{{ (categories | sum(attribute='weekly_total')) |dollars }}</h2>
                </div>
            </div>
            <div class="col-md-4 hidden-sm hidden-xs">
                <div class="col-xs-12 well well-lg bg-primary">
                    <h3 class="text-white">Budget</h3>
                    <h2 class="text-center text-white">{{ (categories | sum(attribute='budget_amount')) | dollars }}</h2>
                </div>
            </div>

        {% if categories %}
        {% for category in categories %}
        <div class="col-md-4 col-sm-6 col-xs-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <a href="{{ url_for('category', category_id=category.id) }}">
                        <strong>{{ category.title }}</strong>
                    </a>
                    <a href="{{ url_for('new_line_item', category_id=category.id) }}">
                        <span class="glyphicon glyphicon-plus pull-right"></span>
                    </a>
                </div>
                <div class="panel-body">
                    <p>Weekly Budgeted: {{ category.budget_amount|dollars }}</p>
                    <p>Weekly total:
                        {% if category.weekly_total %}
                        {{ category.weekly_total|dollars }}
                        {% else %}
                        None so far
                        {% endif %}
                    </p>
                    <p>Remaining:
                        {% if category.weekly_total %}
                        {{ (category.budget_amount - category.weekly_total)|dollars }}
                        {% else %}
                        {{ category.budget_amount|dollars }}
                        {% endif  %}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
</div>

<!-- Monthly Section-->
<div class="panel panel-default">
    <div class="panel-heading">
    <h1>Monthly Stats</h1>
    </div>
    <div class="panel-body">
    <!-- Monthly Dashboard -->
    <div class="col-md-4 col-sm-6 col-xs-12">
            <div class="col-xs-12 well well-lg
                 {{ 'bg-success' if ((categories | sum(attribute='monthly_budget')) - ((categories | sum(attribute='monthly_total') or 0) or 0)) >= 0 }}
                 {{ 'bg-danger' if ((categories | sum(attribute='monthly_budget')) - ((categories | sum(attribute='monthly_total') or 0) or 0)) < 0 }}">
                <h3 class="text-white">Remaining</h3>
                <h2 class="text-center text-white">
                    {{ ((categories | sum(attribute='monthly_budget')) - ((categories | sum(attribute='monthly_total') or 0) or 0)) | dollars}}
                </h2>
            </div>
        </div>
        <div class="col-md-4 col-sm-6 hidden-xs">
            <div class="col-xs-12 well well-lg bg-info">
                <h3 class="text-white">Total</h3>
                <h2 class="text-center text-white">{{ (categories | sum(attribute='monthly_total')) |dollars }}</h2>
            </div>
        </div>
        <div class="col-md-4 hidden-sm hidden-xs">
            <div class="col-xs-12 well well-lg bg-primary">
                <h3 class="text-white">Budget</h3>
                <h2 class="text-center text-white">{{ (categories | sum(attribute='monthly_budget')) | dollars }}</h2>
            </div>
        </div>

    <!-- Monthly Categories -->
    {% if categories %}
    {% for category in categories %}
    <div class="col-md-4 col-sm-6 col-xs-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="{{ url_for('category', category_id=category.id) }}">
                    <strong>{{ category.title }}</strong>
                </a>
                <a href="{{ url_for('new_line_item', category_id=category.id) }}">
                    <span class="glyphicon glyphicon-plus pull-right"></span>
                </a>
            </div>
            <div class="panel-body">
                <p>Monthly amount: {{ category.monthly_budget|dollars }}</p>
                {% if category.monthly_total %}
                <p>Current Month: {{ category.monthly_total|dollars }}</p>
                {% else %}
                None so far
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}
    </div>
</div>
{% endblock %}